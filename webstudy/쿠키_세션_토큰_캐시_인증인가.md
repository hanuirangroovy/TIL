# 쿠키, 세션, 토큰, 캐시, 인증 &인가



## 쿠키

- 쿠키 - 서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각
- 브라우저는 데이터 조각을 저장해 놓았다가, 동일한 서버에 재 요청시 저장된 데이터를 함께 전송하는데 쿠키는 두 요청이 동일한 브라우저에서 들어왔는지 아닌지를 판단할 때 주로 사용
- 사용자의 로그인 상태를 유지할 수 있음
  - stateless HTTP 프로토콜에서 상태 정보를 기억시켜주기 때문

### 주요 세 가지 목적

- 세션 관리
  - 서버에 저장해야 할 로그인, 장바구니, 게임 스코어 등의 정보 관리
- 개인화
  - 사용자 선호, 테마 등의 세팅
- 트래킹
  - 사용자 행동을 기록하고 분석하는 용도

### 쿠키 만들기

- HTTP 요청을 수신할 때, 서버는 응답과 함께 Set-cookie 헤더를 전송할 수 있음
- 쿠키는 보통 브라우저에 의해 저장되며, 그 후 쿠키는 같은 서버에 의해 만들어진 요청들의 cookie 헤더 안에 포함되어 전송
- 만료일 또는 지속시간도 명시될 수 있고, 만료된 쿠키는 더이상 보내지지 않음
- 특정 도메인 혹은 경로 제한을 설정할 수 있으며 이는 쿠키가 보내지는 것을 제한할 수 있음

### 쿠키의 라이프타임

- 세션 쿠키는 현재 세션이 끝날 때 삭제.
  - 브라우저는 현재 세션이 끝나는 시점을 정의하며 어떤 브라우저들은 재시작할 때 세션을 복우너해 세션 쿠키가 무기한 존재할 수 있도록 함.
- 영속적인 쿠키는 Expires 속성에 명시된 날짜에 삭제되거나, Max-Age 속성에 명시되 ㄴ기간 이후에 삭제 됨



## 세션

- 일정 시간동안 같은 사용자로부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 일정하게 유지시키는 기술
  - 일정 시간 : 방문자가 웹 브라우저를 통해 웹 서버에 접속한 시점으로부터 웹 브라우저를 종료함으로써 연결을 끝내는 시점
  - ex. 서버에 로그인 되어있음이 지속되는 상태
- 쿠키와 달리 서버에 인증하기 위한 클라이언트의 정보를 서버 단에서 저장하고 관리
- 쿠키보다 안전.
- 한계가 존재하는 서버 자원을 사용하므로 사용자가 많을 경우 메모리 부족, 속도 저하나 오버헤드 등 서버에 광부하가 올 수 있음



## 토큰

- 부담없이 인가를 구현하기 위해 토큰 방식(JWT)가 고안됨
- 인코딩 또는 암호화된 3가지 데이터를 이어붙인 형태
- header, payload, verify signature 세 부분으로 나뉨
  - header
    - 디코딩하면 두 가지 정보가 담김
    - type - 토큰 타입으로 언제나 JWT가 들어감. 고정값.
    - alg - 서명 값을 만드는데 사용될 알고리즘이 지정됨. HS256 등 여러 암호화 방식 중 하나를 지정할 수 있음.
  - payload
    - Base64로 디코딩해보면 JSON형식으로 여러 정보들이 들어있음.
    - 누가 누구에게 발급했는지 이 토큰이 언제까지 유효한지, 서버가 사용자에게 이 토큰을 통해 공개하기 원해는 내용 등
    - 토큰에 담긴 사용자 정보 등의 데이터를 Claim이라고 함.
  - verify signature
    - header와 payload 그리고 서버에 감춰놓은 비밀 값 이렇게 셋을 암호화 알고리즘에 넣고 돌리면 서명값이 나옴.
- 클레임에 정보가 실려오면 이후 요청마다 사용자로부터 서버한테 보내지고 사용자가 받아서 갖고 있는 토큰 자체에 이런 정보들이 들어있으면 서버가 요청마다 일일이 데이터베이스에서 뒤져봐야할 것들이 줄어듬.
- 서버는 요청에 토큰 값이 실려들어오면 1,2 번의 값을 서버의 비밀 키와 함께 돌려봐서 계산된 결과값이 3번 서명값과 일치하는 결과가 나오는지 확인
- 토큰은 stateless
  - 시간에 따라 바뀌는 어떤 상태값을 안 갖는 걸 의미
  - 세션은 반대로 stateful
- 만료 시간을 가깝게 잡아서 토큰의 수명을 짧게 해주며 단점 보완
  - access 토큰  - 수명이 몇 시간이나 몇 분 이하로 짧음
  - refresh 토큰 - 보통 2주 정도로 수명이 잡혀 있음. 상응값을 데이터베이스에도 저장
  - access 토큰이 수명이 다하면 refresh 토큰이 보내지는데 서버는 그걸 데이터베이스에 저장된 값과 대조해보고 맞다면 새 access 토큰 발급
  - refresh 토큰만 안전하게 관리된다면 이게 유효할 동안은 access 토큰이 만료될 떄마다 다시 로그인할 필요 없이 새로 발급 받을 수 있음



## 캐시

- 데이터 하위 집합을 저장하는 고속 데이터 스토리지 계층
- 해당 데이터에 대한 요청이 있을 경우 데이터의 기본 스토리지 위치에 액세스할 때보다 더 빠르게 처리할 수 있음
- 캐시를 사용하면 이전에 검색하거나 계산한 데이터를 효율적으로 재사용할 수 있음.
- 캐시의 데이터는 일반적으로 RAM과 같이 빠르게 액세스할 수 있는 하드웨어에 저장.
- 주요 목적은 더 느린 기본 스토리지 계층에 액세스해야 하는 필요를 줄임으로써 데이터 검색 성능을 높이는 것.
- 완전하고 영구적인 데이터가 있는 데이터베이스와는 대조적.



## 인증&인가

#### 인증(Authentication)

- 특정 서비스에 일정 권한이 주어진 사용자임을 아이디랑 패스워드 등을 통해 인증 받는 것

  - ex.  로그인

  

#### 인가(Authorization)

- 한 번 인증을 받은 사용자가 이후 서비스의 여러 기능들을 사용할 때 허가를 해주는 것

  

